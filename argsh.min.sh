#!/usr/bin/env bash
# shellcheck disable=SC2178 disable=SC2120 disable=SC1090 disable=SC2046 disable=SC2155 disable=SC2154 disable=SC2329
set -euo pipefail; ARGSH_COMMIT_SHA="6e9f8aad7b1cb940b6942956a01145a3467afba9"; ARGSH_VERSION="v0.2.1-15-g6e9f8aa"
: "${ARGSH_VERSION:=unknown}";: "${ARGSH_COMMIT_SHA:=unknown}";: "${ARGSH_FIELD_WIDTH:=24}";COMMANDNAME=("$(s="${ARGSH_SOURCE:-"${0}"}"; echo "${s##*/}")");declare -ga __ARGSH_BUILTINS=(:usage :usage::help :args is::array is::uninitialized is::set is::tty args::field_name to::int to::float to::boolean to::file to::string import import::clear);declare -g __ARGSH_LIB_DIR="${BASH_SOURCE[0]%/*}";__argsh_try_builtin() { local _so _d;local -r _n="argsh.so";for _so in "${ARGSH_BUILTIN_PATH:-}" "${PATH_LIB:+${PATH_LIB}/${_n}}" "${PATH_BIN:+${PATH_BIN}/${_n}}" ;do [[ -n "${_so}" && -f "${_so}" ]] || continue;enable -f "${_so}" "${__ARGSH_BUILTINS[@]}" 2>/dev/null || continue;return 0;done;for _d in "${LD_LIBRARY_PATH:-}" "${BASH_LOADABLES_PATH:-}";do [[ -n "${_d}" ]] || continue;local IFS=:;for _so in ${_d};do [[ -n "${_so}" && -f "${_so}/${_n}" ]] || continue;enable -f "${_so}/${_n}" "${__ARGSH_BUILTINS[@]}" 2>/dev/null || continue;return 0;done;done;return 1;};declare -gi ARGSH_BUILTIN="${ARGSH_BUILTIN:-0}";if __argsh_try_builtin;then ARGSH_BUILTIN=1;unset -f import 2>/dev/null || true;[[ "$(type -t import 2>/dev/null)" == "builtin" ]] || import() { declare -A _i; (( ${_i[${1}]:-} )) || { _i[${1}]=1; . "${BASH_SOURCE[0]%/*}/${1}.sh"; } };fi;if (( ARGSH_BUILTIN ));then unset -f is::array is::uninitialized is::set is::tty args::field_name to::int to::float to::boolean to::file to::string 2>/dev/null || true;fi;if ! (( ARGSH_BUILTIN ));then :usage::help() { local a44="${1}"; shift;local -a usage=("${@}");:usage::text "${a44}";exit 0;};fi;if ! (( ARGSH_BUILTIN ));then :usage::suggest() { local a36="${1}"; shift;local -a a11=("${@}");local a47="" a4=999;local a83 a3 a81 a53;for (( a83=0; a83 < ${#a11[@]}; a83+=2 ));do a3="${a11[a83]/:*}";a3="${a3#\#}";IFS='|' read -ra _sug_aliases <<< "${a3}";for a81 in "${_sug_aliases[@]}";do a53="$(:usage::levenshtein "${a36}" "${a81}")";if (( a53 < a4 ));then a4="${a53}";a47="${a81}";fi;done;done;if (( a4 > 0 && a4 <= 2 ));then local a12=${#a36};(( ${#a47} > a12 )) && a12=${#a47};if (( a4 * 100 <= a12 * 40 ));then echo "${a47}";fi;fi;};:usage::levenshtein() { local a81="${1}" a82="${2}";local a26=${#a81} a30=${#a82};if (( a26 == 0 )); then echo "${a30}"; return; fi;if (( a30 == 0 )); then echo "${a26}"; return; fi;local -a a62;local a84;for (( a84=0; a84 <= a30; a84++ )); do prev[j]="${a84}"; done;local a83 a16 a50 a13;for (( a83=1; a83 <= a26; a83++ ));do a16="${a62[0]}";a62[0]="${a83}";for (( a84=1; a84 <= a30; a84++ ));do if [[ "${a81:i-1:1}" == "${a82:j-1:1}" ]];then a50=0;else a50=1;fi;a13=$(( a16 + a50 ));(( a62[j] + 1 < a13 )) && a13=$(( a62[j] + 1 ));(( a62[j-1] + 1 < a13 )) && a13=$(( a62[j-1] + 1 ));a16="${a62[a84]}";a62[j]="${a13}";done;done;echo "${a62[a30]}";};:usage() { local a44="${1}"; shift;declare -p usage &>/dev/null || local -a usage=();declare -p args &>/dev/null || local -a args=();[[ $(( ${#usage[@]} % 2 )) -eq 0 ]] || :args::_error "usage must be an associative array";if [[ -z ${1:-} || ${1} == "-h" || ${1} == "--help" ]];then usage=(":usage::help" "${a44}" "${usage[@]}");return 0;fi;if ! (( ${#COMMANDNAME[@]} )) && [[ ${1:-} == "--argsh" ]];then echo "https://arg.sh ${ARGSH_COMMIT_SHA:-} ${ARGSH_VERSION:-}";exit 0;fi;local -A a39=();local -a a67=("${@}");local a68 a32="";while (( ${#a67[@]} ));do if [[ ${a67[0]:0:1} != "-" ]];then [[ -z "${a68:-}" ]] || break;a68="${a67[0]}";a67=("${a67[@]:1}");continue;fi;:args::parse_flag || break;a39["${a32}"]=1;done;:args::check_required_flags;local a56;for (( a83=0; a83 < ${#usage[@]}; a83+=2 ));do IFS='|' read -ra _aliases <<< "${usage[a83]/:*}";for a27 in "${_aliases[@]}";do a27="${a27#\#}";[[ "${a68}" == "${a27}" ]] || continue;a32="${usage[a83]#\#}";a56="${usage[a83]/*:-}";a56="${a56#\#}";[[ "${a56}" == "${usage[a83]}" ]] || break 2;a56="${a56/|*}";break 2;done;done;if [[ -z "${a56:-}" ]];then if [[ -z "${a68:-}" ]];then usage=(":usage::help" "${a44}" "${usage[@]}");return 0;fi;local _sug;_sug="$(:usage::suggest "${a68}" "${usage[@]}")";if [[ -n "${_sug}" ]];then :args::error_usage "Invalid command: ${a68}. Did you mean '${_sug}'?";else :args::error_usage "Invalid command: ${a68}";fi;fi;local a8=0;[[ "${a32}" != *":-"* ]] || a8=1;if (( a8 ));then declare -F -- "${a56}" >/dev/null 2>&1 || { local _sug;_sug="$(:usage::suggest "${a68}" "${usage[@]}")";if [[ -n "${_sug}" ]];then :args::error_usage "Invalid command: ${a68}. Did you mean '${_sug}'?";else :args::error_usage "Invalid command: ${a68}";fi;};else local a15="${FUNCNAME[1]:-}";if [[ -n "${a15}" ]] && declare -F -- "${a15}::${a56}" >/dev/null 2>&1;then a56="${a15}::${a56}";elif declare -F -- "argsh::${a56}" >/dev/null 2>&1;then a56="argsh::${a56}";elif declare -F -- "${a56}" >/dev/null 2>&1;then :;else local _sug;_sug="$(:usage::suggest "${a68}" "${usage[@]}")";if [[ -n "${_sug}" ]];then :args::error_usage "Invalid command: ${a68}. Did you mean '${_sug}'?";else :args::error_usage "Invalid command: ${a68}";fi;fi;fi;COMMANDNAME+=("${a32/[|:]*}");usage=("${a56}" "${a67[@]}");};:usage::text() { local a44="${1:-}";string::indent "${a44}";echo;echo "Usage: ${COMMANDNAME[*]} <command> [args]";[[ ${usage[0]:-} == '-' ]] || echo -e "\nAvailable Commands:";for (( a83=0; a83 < ${#usage[@]}; a83+=2 ));do [[ "${usage[a83]:0:1}" != "#" ]] || continue;[[ "${usage[a83]}" != "-" ]] || { echo;echo "${usage[a83+1]}";continue;};printf "  %-${ARGSH_FIELD_WIDTH}s %s\n" "${usage[a83]/[:|]*}" "${usage[a83+1]}";done;:args::text_flags;echo;echo "Use \"${COMMANDNAME[*]} <command> --help\" for more information about a command.";};:args() { local a44="${1}"; shift;declare -p args &>/dev/null || local -a args=();[[ $(( ${#args[@]} % 2 )) -eq 0 ]] || :args::_error "args must be an associative array";if [[ ${1:-} == "-h" || ${1:-} == "--help" ]];then :args::text;exit 0;fi;local a33=0 a32="" a83 a0=1;local -A a39=();local -a a67=("${@}");while (( ${#a67[@]} ));do if [[ ${a67[0]:0:1} != "-" ]];then local a60 a45;a83="$(:args::field_positional "${a0}")" || :args::error_usage "too many arguments: ${a67[0]}";a32="${args[a83]}";a60="$(args::field_name "${a32}")";a45="$(:args::field_value "${a67[0]}")" || exit "${?}";local -n a73="${a60}";if is::array "${a60}";then (( a33 )) || { a73=();a33=1;};a73+=("${a45}");else a73="${a45}";fi;a67=("${a67[@]:1}");(( ++a0 ));continue;fi;:args::parse_flag || :args::error_usage "unknown a55: ${a67[0]}";a39["${a32}"]=1;done;if a83="$(:args::field_positional "${a0}")";then a32="$(args::field_name "${args[a83]}")";if is::uninitialized "${a32}" && ! is::array "${a32}";then :args::error_usage "missing required argument: ${a32}";fi;fi;:args::check_required_flags;[[ ${#a67[@]} -eq 0 ]] || :args::error_usage "too many arguments: ${a67[*]}";};:args::text() { declare -p args &>/dev/null || return 0;local -a a2=() a22=();:args::positional;string::indent "${a44}";echo;echo "Usage:";echo "  ${COMMANDNAME[*]} ${a22[*]}";(( ${#a2[@]} == 0 )) || { echo;echo "Arguments:";for a83 in "${a2[@]}";do [[ ${args[a83]} != "-" ]] || continue;a52="$( printf "   %-${ARGSH_FIELD_WIDTH}s%s" " " "${args[a83+1]}" | fmt::tty;)";printf "   %-${ARGSH_FIELD_WIDTH}s%s\n" "$(:args::fieldf "${args[a83]}")" "$(string::trim-left "${a52}")";done;};:args::text_flags;echo;};:args::text_flags() { local -a args=("${args[@]}");local -a a34=();array::contains 'help|h:+' "${args[@]}" || args+=('help|h:+' "Show this help message");:args::flags;(( ${#a34[@]} )) || return 0;[[ "${args[${a34[0]}]}" == "-" ]] || echo -e "\nOptions:";for a83 in "${a34[@]}";do [[ "${args[a83]:0:1}" != "#" ]] || continue;[[ "${args[a83]}" != "-" ]] || { echo;echo "${args[a83+1]}";continue;};:args::fieldf "${args[a83]}";{ echo -n "           ";echo -e "${args[a83+1]}\n";} | fmt::tty;done;};:args::flags() { declare -p args &>/dev/null || local -a args;declare -p a34 &>/dev/null || local -a a34;for (( a83=0; a83 < "${#args[@]}"; a83+=2 ));do if [[ ${args[a83]} == *"|"* || ${args[a83]} == '-' ]];then a34+=("${a83}");fi;done;};:args::positional() { declare -p args &>/dev/null || local -a args;declare -p a2 &>/dev/null || local -a a2;declare -p a22 &>/dev/null || local -a a22;local a73;for (( a83=0; a83 < "${#args[@]}"; a83+=2 ));do [[ ${args[a83]} != *"|"* && ${args[a83]} != '-' ]] || continue;a73="$(args::field_name "${args[a83]}")";a2+=("${a83}");if is::array "${a73}";then a22+=("...${a73}");continue;fi;if ! is::uninitialized "${a73}";then a22+=("[${a73}]");continue;fi;a22+=("<${a73}>");done;};:args::parse_flag() { declare -p a67 a32 &>/dev/null || return 1;local a55="${a67[0]/=*}";if [[ ${a55:0:2} == "--" ]];then a32="$(:args::field_lookup "${a55:2}")" || return "${?}";elif [[ ${a55:0:1} == "-" ]];then a55="${a55:0:2}";a32="$(:args::field_lookup "${a55:1}")" || return "${?}";fi;:args::field_set_flag "${a32}";};:args::check_required_flags() { declare -p a39 args &>/dev/null || return 1;local a32;local -a a29;for (( a83=0; a83 < ${#args[@]}; a83+=2 ));do a32="${args[a83]}";:args::field_attrs "${a32}";if (( a29[2] )) && ! (( a29[4] ));then local -n a73="${a29[0]}";a73=0;fi;if (( a29[6] )) && [[ -z ${a39[${args[a83]}]:-} ]];then :args::error_usage "missing required a55: ${args[a83]/|*}";fi;done;};:args::field_set_flag() { local a32="${1}";declare -p a67 a55 &>/dev/null || return 1;local -a a29;:args::field_attrs "${a32}";local -n a73="${a29[0]}";local a7 a5;if (( a29[2] ));then a7=1;if [[ ${a55:0:2} == "--" ]];then a67=("${a67[@]:1}");else a67[0]="-${a67[0]:2}";[[ ${a67[0]} != "-" ]] || a67=("${a67[@]:1}");fi;fi;[[ -n ${a7:-} ]] || { a5="${a67[0]/${a55}}";if [[ ${a5} == "" ]];then (( ${#a67[@]} > 1 )) || :args::error "missing value for a55: ${a29[0]}";a7="${a67[1]}";a67=("${a67[@]:1}");else [[ "${a5:0:1}" != "=" ]] || a5="${a5:1}";a7="${a5}";fi;a7="$(:args::field_value "${a7}")" || exit "${?}";a67=("${a67[@]:1}");};if (( a29[5] ));then a73+=("${a7}");else a73="${a7}";fi;};:args::field_value() { local a45="${1}";declare -p a32 &>/dev/null || return 1;declare -p a29 &>/dev/null || { local -a a29;:args::field_attrs "${a32}";};declare -f "to::${a29[3]}" &>/dev/null || :args::_error "unknown type: ${a29[3]}";"to::${a29[3]}" "${a45}" "${a29[0]}" || :args::error_usage "invalid type (${a29[3]}): ${a45}";};:args::field_lookup() { local a32="${1}";declare -p args &>/dev/null || return 1;for (( a83=0; a83 < ${#args[@]}; a83+=2 ));do if [[ ${args[a83]} =~ (^${a32}\||\|${a32}:|\|${a32}$) ]];then echo "${args[a83]}";return 0;fi;done;return 1;};:args::field_positional() { local a9="${1:-1}";declare -p args &>/dev/null || return 1;for (( a83=0; a83 < ${#args[@]}; a83+=2 ));do if [[ ${args[a83]} != *"|"* && ${args[a83]} != '-' ]];then if is::array "$(args::field_name "${args[a83]}")" || (( --a9 == 0 ));then echo "${a83}";return 0;fi;fi;done;return 1;};args::field_name() { local a32="${1}";local a28="${2:-1}";a32="${a32/[|:]*}";a32="${a32#\#}";if (( a28 ));then a32="${a32//-/_}";fi;echo "${a32}";};:args::field_attrs() { local a32="${1}";declare -p a29 &>/dev/null || local -a a29;a29=( "" "" 0 "" 0 0 0 0 "" );local a64="+~!";local a59="${a32#*[:]}";[ "${a59}" != "${a32}" ] || a59="";a29[0]="$(args::field_name "${a32}")";a29[8]="$(args::field_name "${a32}" 0)";[[ ${a29[0]:0:1} != "#" ]] || { a29[7]=1;};local -n a73="${a29[0]}";local -a a34;IFS='|' read -ra a34 <<< "${a32/[:]*}";[[ ${#a34[@]} -eq 1 ]] || { a29[1]="${a34[1]}";};if is::array "${a29[0]}";then a29[5]=1;! is::uninitialized "${a29[0]}" || a73=();! (( ${#a73[@]} )) || a29[4]=1;elif ! is::uninitialized "${a29[0]}";then a29[4]=1;fi;while (( ${#a59} > 0 ));do if [[ ${a59:0:1} == "+" ]];then [[ -z ${a29[3]} ]] || :args::_error "cannot have multiple types: ${a29[3]} and boolean";a29[2]=1;a59="${a59:1}";continue;fi;if [[ ${a59:0:1} == "~" ]];then ! (( a29[2] )) || :args::_error "already flagged as boolean";a59="${a59:1}";a29[3]="${a59/[$a64]*}";a59="${a59:${#a29[3]}}";continue;fi;if [[ ${a59:0:1} == "!" ]];then ! (( a29[6] )) || :args::_error "field already flagged as required";a29[6]=1;a59="${a59:1}";continue;fi;echo ":args error: unknown modifier: ${a59:0:1}" >&2;exit 2;done;if [[ -z ${a29[3]} && ${a29[2]} -eq 0 ]];then a29[3]="string";fi;};:args::fieldf() { local a32="${1}";declare -p a29 &>/dev/null || { local -a a29;:args::field_attrs "${a32}";};[[ ${a32} == *"|"* ]] || { echo "${a29[8]} ${a29[3]}";return 0;};local -n a73="${a29[0]}";a17="   ";! (( a29[6] )) || a17=" ! ";if [[ -n ${a29[1]} ]];then a17+="-${a29[1]}, --${a29[8]}";else a17+="    --${a29[8]}";fi;a17+=" ";! (( a29[5] )) || a17+="...";a17+="${a29[3]}";if (( a29[4] )) && ! (( a29[2] ));then a17+=" (default: ${a73[*]})";fi;echo "${a17}";};fi;args::run() { local a66="${1}"; shift;for (( a83=0; a83<${#}; a83++ ));do local a74="${1}"; shift;local a56="${1}"; shift;if ! (( a66 )) || (( a74 ));then "${a56}";fi;done;};array::contains() { local -r a21="${1}"; shift;for a10 in "${@}";do [[ "${a10}" != "${a21}" ]] || return 0;done;return 1;};array::join() { local -r a6="${1}"; shift;local a23;printf -v a23 "${a6}%s" "${@}";echo "${a23:${#a6}}";};array::nth() { local -n a72="${1}";local -r a71="${2}";shift 2;for (( a83=1; a83<=${#}; a83++ ));do (( a83 % a71 )) || a72+=("${!a83}");done;};bash::version() { local a38="${1:-4}";local a40="${2:-3}";local a41="${3:-0}";if [[ "${BASH_VERSINFO[0]}" -lt "${a38}" ]];then return 1;elif [[ "${BASH_VERSINFO[0]}" -gt "${a38}" ]];then return 0;fi;if [[ "${BASH_VERSINFO[1]}" -lt "${a40}" ]];then return 1;elif [[ "${BASH_VERSINFO[1]}" -gt "${a40}" ]];then return 0;fi;if [[ "${BASH_VERSINFO[2]}" -lt "${a41}" ]];then return 1;fi;return 0;};binary::exists() { local a14="${1}";command -v "${a14}" &> /dev/null || { echo "${a14} is required to run this script" >&2;return 1;};};binary::github() { local a61="${1}";local a63="${2}";local a54="${3}";local a77="${4:-}";curl -Lso /dev/stdout "https://github.com/${a63}/releases/download/${a54}" | { if [[ -n "${a77}" ]];then tar -xz -C "$(dirname "${a61}")" "${a77}";else tee "${a61}" &> /dev/null;fi;chmod +x "${a61}";};};binary::arch() { local a43="${1:-0}";local -r a46="$(uname -m)";case "${a46}" in
x86_64|amd64)if (( a43 )); then echo "64-bit"; else echo "amd64"; fi;;
armv7l)echo "arm";;
aarch64)echo "arm64";;
*)echo "${a46}";;
esac;};binary::jq() { binary::exists "jq" 2>/dev/null || { local -r a19="$(github::latest "stedolan/jq")" a25="$(uname -s)";binary::github "${PATH_BIN?}/jq" "stedolan/jq" "${a19}/jq-${a25,,}-$(binary::arch)";};};binary::vale() { binary::exists "vale" 2>/dev/null || { local -r a19="$(github::latest "errata-ai/vale")" a25="$(uname -s)";binary::github "${PATH_BIN?}/vale" "errata-ai/vale" "${a19}/vale_${a19:1}_$(uname -s)_$(binary::arch 1).tar.gz" "vale";};};docker::user() { local a79="${1:-"$(id -u)"}";local a70="${2:-"$(id -g)"}";local a65="${3:-"$(whoami)"}";local a57="${4:-"/workspace"}";local a42="${5:-"/bin/sh"}";local a51;a51="$(pwd)";a51="${a51#"${PATH_BASE:-}"}";if [[ "${a51}" == "$(pwd)" ]];then a51="${a57}";else a51="${a57}${a51}";fi;local _passwd _group;_passwd="$(mktemp /tmp/docker_passwd.XXXXXX)";_group="$(mktemp /tmp/docker_group.XXXXXX)";echo "${a65}:x:${a79}:${a70}::${a57}:${a42}" > "${_passwd}";echo "${a65}:x:${a70}:" > "${_group}";echo "-v ${_passwd}:/etc/passwd -v ${_group}:/etc/group";echo "-u ${a79}:${a70}";echo "-v ${PATH_BASE:-"$(pwd)"}:${a57}";echo "-w ${a51}";};error::stacktrace() { local -r a48="${1:-${?}}";if (( a48 ));then echo -e "\n\033[38;5;196m■■ Stacktrace(${a48}): \e[1m${BASH_COMMAND}\e[22m";for (( a83 = 1; a83 <= ${#FUNCNAME[@]} - 2; a83++ ));do echo -e "${a83}. ${BASH_SOURCE[a83]}:${BASH_LINENO[a83-1]} ➜ ${FUNCNAME[a83]}()";done;echo -e "\033[0m";return "${a48}";fi;};:args::_error() { echo -e "Error: ${1}" >&2;exit 2;};:args::error() { echo -e "Error: ${1}\n" >&2;echo "  Run \"${0##*/} -h\" for more information." >&2;exit 2;};:args::error_usage() { echo -e "Error: ${1}\n" >&2;echo "  Run \"${0##*/} -h\" for more information." >&2;exit 2;};fmt::tty() { local a76="${1:-"$(cat)"}";if ! command -v fmt &>/dev/null || [[ ! -t 1 ]];then echo "${a76}";return 0;fi;local a49;a49="$(tput cols)";echo "${a76}" | fmt -w "${a49}";};github::latest() { local a63="${1}";curl -fsSLI -o /dev/null -w "%{url_effective}" "https://github.com/${a63}/releases/latest" | rev | cut -d'/' -f1 | rev;};declare -gA a1=();: "${__ARGSH_LIB_DIR:=${BASH_SOURCE[0]%/*}}";import() { local a75="${1}";(( ${a1["${a75}"]:-} )) || { a1["${a75}"]=1;if [[ ${a75:0:1} == "@" ]];then a75="${PATH_BASE:?"PATH_BASE missing"}/${a75:1}";elif [[ ${a75:0:1} == "~" ]];then local _s="${ARGSH_SOURCE:-${BASH_SOURCE[-1]}}";a75="${_s%/*}/${a75:1}";else local _s="${ARGSH_SOURCE:-${BASH_SOURCE[0]}}";a75="${_s%/*}/${a75}";fi;import::source "${a75}" || exit 1;};};import::source() { local a75="${1}";for a69 in "" ".sh" ".bash";do if [[ -f "${a75}${a69}" ]];then . "${a75}${a69}";return;fi;done;echo "Library not found ${a75}" >&2;return 1;};import::clear() { a1=();};is::tty() { [[ -t 1 ]];};is::array() { local _decl;_decl="$(declare -p "${1}" 2>/dev/null)" || return 1;[[ "${_decl}" == "declare -a"* ]];};is::uninitialized() { local a80="${1}";if is::array "${a80}";then [[ $(declare -p "${a80}") =~ ^declare\ -a\ ${a80}(=\(\))?$ ]];else [[ ! ${!a80+x} ]];fi;};is::set() { ! is::uninitialized "${1}";};argsh::builtin::try() { if [[ -n "${1:-}" ]];then [[ -f "${1}" ]] || return 1;enable -f "${1}" "${__ARGSH_BUILTINS[@]}" 2>/dev/null || return 1;return 0;fi;__argsh_try_builtin;};argsh::builtin::location() { local _so _d;local -r _n="argsh.so";for _so in "${ARGSH_BUILTIN_PATH:-}" "${PATH_LIB:+${PATH_LIB}/${_n}}" "${PATH_BIN:+${PATH_BIN}/${_n}}" ;do [[ -n "${_so}" && -f "${_so}" ]] && { echo "${_so}"; return 0; };done;for _d in "${LD_LIBRARY_PATH:-}" "${BASH_LOADABLES_PATH:-}";do [[ -n "${_d}" ]] || continue;local IFS=:;for _so in ${_d};do [[ -n "${_so}" && -f "${_so}/${_n}" ]] && { echo "${_so}/${_n}"; return 0; };done;done;[[ -f "${HOME}/.local/lib/bash/${_n}" ]] && { echo "${HOME}/.local/lib/bash/${_n}"; return 0; };echo "not installed";return 1;};argsh::builtin::install_dir() { local _d;if [[ -n "${PATH_BIN:-}" && -d "${PATH_BIN}" && -w "${PATH_BIN}" ]];then echo "${PATH_BIN}"; return 0;fi;if [[ -n "${PATH_LIB:-}" && -d "${PATH_LIB}" && -w "${PATH_LIB}" ]];then echo "${PATH_LIB}"; return 0;fi;if [[ -n "${BASH_LOADABLES_PATH:-}" ]];then local IFS=:;for _d in ${BASH_LOADABLES_PATH};do [[ -d "${_d}" && -w "${_d}" ]] && { echo "${_d}"; return 0; };done;fi;_d="${HOME}/.local/lib/bash";mkdir -p "${_d}" 2>/dev/null || true;if [[ -d "${_d}" && -w "${_d}" ]];then echo "${_d}"; return 0;fi;return 1;};argsh::builtin::download() { local _force="${1:-0}" _dir _dest _tag;if (( ! _force )) && argsh::builtin::try 2>/dev/null;then echo "argsh: builtins already installed" >&2;return 0;fi;[[ "$(uname -s)" == "Linux" && "$(uname -m)" == "x86_64" ]] || { echo "argsh: builtins only available for linux/amd64 (got $(uname -s)/$(uname -m))" >&2;return 1;};_dir="$(argsh::builtin::install_dir)" || { echo "argsh: no writable install path found for builtins" >&2;echo "  Run: argsh builtins install --path /your/writable/dir" >&2;return 1;};_dest="${_dir}/argsh.so";command -v curl &>/dev/null || { echo "argsh: curl is required to download builtins" >&2;return 1;};_tag="$(github::latest "arg-sh/argsh")" || { echo "argsh: failed to get latest release from GitHub" >&2;return 1;};echo "argsh: downloading argsh.so (${_tag})..." >&2;curl -fsSL -o "${_dest}" "https://github.com/arg-sh/argsh/releases/download/${_tag}/argsh.so" || { echo "argsh: download failed" >&2;rm -f "${_dest}";return 1;};echo "argsh: installed to ${_dest}" >&2;argsh::builtin::try "${_dest}" || { echo "argsh: downloaded file failed to load as builtin" >&2;rm -f "${_dest}";return 1;};return 0;};argsh::builtins() { case "${1:-}" in
install)shift; argsh::builtin::_install "${@}";;
update)shift; argsh::builtin::_install --force "${@}";;
*)local _loc;_loc="$(argsh::builtin::location 2>/dev/null)" || _loc="not installed";echo "argsh builtins: ${_loc}";echo "";echo "Usage: argsh builtins install|update [--force] [--path DIR]";;
esac;};argsh::builtin::_install() { local _force=0 _path="";while [[ "${1:-}" == --* ]];do case "${1}" in
--force)_force=1; shift;;
--path)shift; _path="${1}"; shift;;
*)echo "argsh: unknown option: ${1}" >&2; return 1;;
esac;done;if [[ -n "${_path}" ]];then [[ -d "${_path}" && -w "${_path}" ]] || { echo "argsh: directory not writable: ${_path}" >&2;return 1;};PATH_BIN="${_path}" argsh::builtin::download "${_force}";else argsh::builtin::download "${_force}";fi;};argsh::shebang() { local _argsh_builtin_mode="" _argsh_builtin_path="";local -a _argsh_imports=();while [[ "${1:-}" == -* ]];do case "${1}" in
--builtin)_argsh_builtin_mode="required";shift;if [[ -n "${1:-}" && "${1:0:1}" != "-" && "${1}" == *.so ]];then _argsh_builtin_path="${1}";shift;fi;;
--no-builtin)_argsh_builtin_mode="disabled";shift;;
--import|-i)shift;[[ -n "${1:-}" ]] || { echo "argsh: --import requires an argument" >&2; return 1; };_argsh_imports+=("${1}");shift;;
--version)echo "argsh ${ARGSH_VERSION:-unknown} (${ARGSH_COMMIT_SHA:-unknown})";return 0;;
--)shift; break;;
*)break;;
esac;done;local -r a54="${1}";: "${ARGSH_SOURCE="${a54}"}";export ARGSH_SOURCE;case "${a54}" in
builtins)shift; argsh::builtins "${@}"; return;;
esac;[[ "${BASH_SOURCE[-1]}" != "${a54}" && -f "${a54}" ]] || { binary::exists docker || { echo "This script requires Docker to be installed";return 1;} >&2;local a78="";! tty -s || a78="-it";docker run --rm ${a78} $(docker::user) -e "BATS_LOAD" -e "ARGSH_SOURCE" -e "GIT_COMMIT_SHA=$(git rev-parse HEAD 2>/dev/null || :)" -e "GIT_VERSION=$(git describe --tags --dirty 2>/dev/null || :)" ghcr.io/arg-sh/argsh:latest "${@}";return 0;};bash::version 4 3 0 || { echo "This script requires bash 4.3.0 or later";return 1;} >&2;declare -gi ARGSH_BUILTIN=0;case "${_argsh_builtin_mode}" in
required)argsh::builtin::try "${_argsh_builtin_path}" || { if [[ -n "${_argsh_builtin_path}" ]];then echo "argsh: builtin not found: ${_argsh_builtin_path}" >&2;return 1;fi;argsh::builtin::download || return 1;};ARGSH_BUILTIN=1;;
disabled);;
*)argsh::builtin::try && ARGSH_BUILTIN=1;;
esac;local _lib;for _lib in "${_argsh_imports[@]}";do import "${_lib}";done;shift;. "${a54}";};string::drop-index() { local a24="${1}";local a35="${2}";local a20="${3:-1}";echo "${a24:0:a35}${a24:a35+a20}";};string::random() { local a20="${1:-42}";local a31="${2:-"a-zA-Z0-9"}";local a76;until [[ "${a76:-}" =~ ^[[:alpha:]] ]];do a76=$(tr -dc "${a31}" < /dev/urandom | fold -w "${a20}" | head -n 1 || :);done;echo "${a76}";};string::indent() { local a24="${1:-'-'}";local a18="${2:-0}";local a58 a37;[[ ${a24} != '-' ]] || a24="$(cat)";mapfile -t a37 < <(echo "${a24}");for a58 in "${a37[@]}";do a58="$(string::trim-left "${a58}")";(( a18 == 0 )) || printf "%${a18}s" " ";echo "${a58}";done;};string::trim-left() { local a24="${1}";local a31="${2:-" "$'\n'$'\t'}";[[ -n ${a24:-} ]] || return 0;[[ ${a24} != '-' ]] || a24="$(cat)";while [[ -n "${a24}" ]];do [[ ${a31} == *"${a24:0:1}"* ]] || break;a24="${a24:1}";done;echo "${a24}";};string::trim-right() { local a24="${1:-'-'}";local a31="${2:-" "$'\n'$'\t'}";[[ ${a24} != '-' ]] || a24="$(cat)";while [[ -n "${a24}" ]];do [[ ${a31} == *"${a24: -1}"* ]] || break;a24="${a24:0: -1}";done;echo "${a24}";};string::trim() { local a24="${1:-'-'}";local a31="${2:-" "$'\n'$'\t'}";[[ ${a24} != '-' ]] || a24="$(cat)";echo "${a24}" | string::trim-left - "${a31}" | string::trim-right - "${a31}";};to::string() { local a45="${1}";echo "${a45}";};to::boolean() { local a45="${1}";case "${a45}" in
""|"false"|"0")a45="0";;
*)a45="1";;
esac;echo "${a45}";};to::int() { local a45="${1}";[[ ${a45} =~ ^-?[0-9]+$ ]] || return 1;echo "${a45}";};to::float() { local a45="${1}";[[ ${a45} =~ ^-?[0-9]+(\.[0-9]+)?$ ]] || return 1;echo "${a45}";};to::stdin() { local a45="${1}";[[ ${a45} != "-" ]] || a45="$(cat)";echo "${a45}";};to::file() { local a45="${1}";[[ -f "${a45}" ]] || return 1;echo "${a45}";};[[ "${BASH_SOURCE[0]}" != "${0}" ]] || argsh::shebang "${@}"